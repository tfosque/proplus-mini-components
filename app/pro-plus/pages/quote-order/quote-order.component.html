<div>
    <h1>
        <mat-icon style="margin-right: 10px; font-size: 30px"
            >shopping_cart</mat-icon
        >
        Quote Order
    </h1>
</div>
<div class="loading-container" *ngIf="loading; else cart">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</div>
<ng-template #cart>
    <!-- validation that the shopping cart has items -->
    <div *ngIf="cartItems.length; else emptyCart">
        <!-- beginning of the stepper -->
        <mat-horizontal-stepper [linear]="true" #stepper>
            <mat-step>
                <ng-template matStepLabel>
                    <span>Quote Order</span>
                    <!-- <mat-icon>shopping_cart</mat-icon> -->
                </ng-template>
                <app-quote-disclaimer></app-quote-disclaimer>
                <div class="grid-x">
                    <div class="cell small-4">
                        <mat-form-field
                            class="full-width"
                            floatLabel="auto"
                            style="padding-top: 0.5em"
                        >
                            <input
                                matInput
                                placeholder="Quote Name"
                                maxlength="22"
                                [(ngModel)]="quoteOrderDetail.displayName"
                                [formControl]="quoteFormControl"
                                [errorStateMatcher]="matcher"
                                [disabled]="true"
                                required
                            />
                            <mat-error
                                *ngIf="quoteFormControl.hasError('required')"
                            >
                                This field is required
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <!-- Button Bar -->
                <div class="grid-x">
                    <!-- TODO Keep up here -->
                    <div class="cell small-12 medium-12">
                        <app-product-selector
                            [accountId]="accountId"
                            (productAdded)="addProduct($event)"
                        >
                        </app-product-selector>
                    </div>
                </div>
                <div class="margin-x grid-x">
                    <!-- Shopping Cart  -->
                    <div style="padding-right: 10px" class="cell large-12">
                        <table
                            mat-table
                            [dataSource]="cartItems"
                            matSort
                            class="full-width padded-table"
                        >
                            <ng-container matColumnDef="product">
                                <th
                                    mat-header-cell
                                    *matHeaderCellDef
                                    mat-sort-header
                                >
                                    Product
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <img
                                        appImagePreload
                                        style="height: 80px; width: 80px"
                                        src="{{ element.thumbImageUrl }}"
                                        default="{{
                                            element.imageOnErrorUrl | errorImage
                                        }}"
                                    />
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="details">
                                <th
                                    mat-header-cell
                                    *matHeaderCellDef
                                    mat-sort-header
                                >
                                    Details
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <a
                                        [innerHTML]="
                                            element.description
                                                ? element.description
                                                : element.atgItemDescription
                                        "
                                        [routerLink]="[
                                            '/productDetail',
                                            element.productId || ''
                                        ]"
                                    ></a>
                                    <div>
                                        <strong>Item #:</strong>
                                        <span>{{ element.itemNumber }}</span>
                                    </div>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="price">
                                <th
                                    mat-header-cell
                                    *matHeaderCellDef
                                    mat-sort-header
                                >
                                    Price
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <div
                                        *ngIf="
                                            element.price > 0 ||
                                                element.atgItemNetPrice > 0;
                                            else noPrice
                                        "
                                    >
                                        <strong>
                                            <span>{{
                                                element.price ||
                                                    element.atgItemNetPrice
                                                    | currency
                                            }}</span>
                                            <span> / </span>
                                            <span>{{ element.uom }}</span>
                                        </strong>
                                    </div>
                                    <ng-template #noPrice>
                                        <span
                                            >Price calculated at invoicing</span
                                        >
                                    </ng-template>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="qty">
                                <th
                                    mat-header-cell
                                    *matHeaderCellDef
                                    mat-sort-header
                                >
                                    Qty
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <mat-form-field class="quantity-input">
                                        <input
                                            matInput
                                            [(ngModel)]="element.quantity"
                                            min="0"
                                            max="9999"
                                            type="number"
                                        />
                                    </mat-form-field>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="total">
                                <th
                                    mat-header-cell
                                    *matHeaderCellDef
                                    mat-sort-header
                                >
                                    Total
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <div
                                        *ngIf="
                                            (!element.quotedItemQtyChanged &&
                                                !isQuantityChanged(element)) ||
                                                !element.itemFromQuote;
                                            else noSubTotal
                                        "
                                    >
                                        <span>{{
                                            element.price * element.quantity ||
                                                element.atgItemTotalPrice
                                                | currency
                                        }}</span>
                                    </div>
                                    <ng-template #noSubTotal>
                                        <span
                                            >Price calculated at invoicing</span
                                        >
                                    </ng-template>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="action">
                                <th mat-header-cell *matHeaderCellDef>
                                    <!-- <button color="secondary" (click)="openDialog()" mat-raised-button type="button" style="font-size:10px;"> Erase Cart </button>  -->
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <a
                                        href="javascript:void(0);"
                                        (click)="openDialogOneItem(element)"
                                    >
                                        <mat-icon color="emphasis"
                                            >delete</mat-icon
                                        >
                                    </a>
                                </td>
                            </ng-container>
                            <tr
                                mat-header-row
                                *matHeaderRowDef="displayedColumns"
                            ></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedColumns"
                            ></tr>
                        </table>

                        <!-- TODO (Tim): to review since this never renders -->
                        <!-- <app-dump-grid
                            *ngIf="false"
                            [input]="cartItems"
                        ></app-dump-grid> -->
                        <!-- TODO - Cart actions here -->

                        <div
                            class="margin-x grid-x grid-margin-x"
                            style="margin-top: 10px; background-color: #ebedef"
                        >
                            <div class="cell small-12 medium-6">
                                <button
                                    class="btn-custom"
                                    color="primary"
                                    (click)="updateCart()"
                                >
                                    Save All
                                    <mat-icon style="vertical-align: middle"
                                        >refresh</mat-icon
                                    >
                                </button>
                            </div>
                            <div
                                class="cell small-12 medium-6"
                                style="text-align: right"
                            >
                                <button
                                    class="btn-custom"
                                    color="primary"
                                    (click)="goToCheckout()"
                                >
                                    Proceed to Checkout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TODO - Summary here -->
            </mat-step>
            <mat-step>
                <ng-template matStepLabel>
                    <span>Shipping</span>
                    <!-- <mat-icon>room</mat-icon> -->
                </ng-template>
                <app-quote-disclaimer></app-quote-disclaimer>
                <mat-divider class="divider"></mat-divider>
                <div>
                    <p style="font-weight: bold">CHOOSE YOUR DELIVERY OPTION</p>
                    <mat-divider class="divider"></mat-divider>
                    <mat-radio-group [(ngModel)]="DeliveryOpt">
                        <div>
                            <!-- checkboxes validate certain sreas show or not -->
                            <mat-radio-button color="primary" [value]="true">
                                Schedule Delivery Or Pick-Up</mat-radio-button
                            >
                        </div>
                        <div>
                            <mat-radio-button color="primary" [value]="false">
                                Place Order On Hold</mat-radio-button
                            >
                        </div>
                    </mat-radio-group>
                </div>
                <div *ngIf="DeliveryOpt">
                    <p style="font-weight: bold">
                        PREFERRED PICKUP/DELIVERY DATE AND TIME
                    </p>
                    <mat-divider class="divider"></mat-divider>
                    <!-- date and  time inputs -->
                    <form>
                        <div class="datetimeinputs">
                            <mat-form-field class="half" floatLabel="auto">
                                <input
                                    matInput
                                    [matDatepickerFilter]="myFilter"
                                    [max]="maxDate"
                                    [min]="minDate"
                                    [matDatepicker]="pick"
                                    placeholder="Choose a date"
                                    [(ngModel)]="date"
                                    [formControl]="dateAndTimeFormControl"
                                    [errorStateMatcher]="matcher"
                                />
                                <mat-datepicker-toggle
                                    matSuffix
                                    [for]="pick"
                                ></mat-datepicker-toggle>
                                <mat-datepicker
                                    #pick
                                    disabled="false"
                                ></mat-datepicker>
                                <mat-error
                                    *ngIf="
                                        dateAndTimeFormControl.hasError(
                                            'required'
                                        )
                                    "
                                >
                                    Date is required
                                </mat-error>
                                <mat-error *ngIf="date < minDate"
                                    >Date can not be before today</mat-error
                                >
                            </mat-form-field>
                        </div>
                        <div class="datetimeinputs">
                            <mat-form-field class="half" floatLabel="auto">
                                <mat-select
                                    placeholder="Time"
                                    [(ngModel)]="time"
                                    [formControl]="timeFormControl"
                                    [errorStateMatcher]="matcher"
                                    (opened)="(getTimesAvailable)"
                                    required
                                >
                                    <mat-option>--Select a Time--</mat-option>
                                    <mat-option
                                        *ngIf="
                                            availablePickupTimes.length === 0
                                        "
                                        [disabled]="true"
                                        >No times available for pickup
                                    </mat-option>
                                    <mat-option
                                        *ngFor="
                                            let time of availablePickupTimes
                                        "
                                        [value]="time.key"
                                    >
                                        {{ time.value }}
                                    </mat-option>
                                </mat-select>
                                <mat-error
                                    *ngIf="timeFormControl.hasError('required')"
                                >
                                    Time is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </form>
                </div>
                <div>
                    <p style="font-weight: bold">CHOOSE YOUR DELIVERY METHOD</p>
                    <mat-divider class="divider"></mat-divider>
                    <mat-radio-group
                        [(ngModel)]="DeliveryMethod"
                        (change)="changeDeliveryethod($event)"
                    >
                        <div>
                            <mat-radio-button color="primary" [value]="false">
                                Pick Up In Store
                            </mat-radio-button>
                        </div>
                        <div>
                            <mat-radio-button color="primary" [value]="true">
                                Shipping To Address
                            </mat-radio-button>
                        </div>
                    </mat-radio-group>
                </div>
                <div *ngIf="!DeliveryMethod">
                    <mat-divider class="divider"></mat-divider>
                    <div>
                        <p style="font-weight: bold">STORE PICK-UP ADDRESS</p>
                    </div>
                    <!-- Selected Branch -->
                    <div>
                        <div class="grid-container">
                            <div class="grid-x grid-margin-x grid-margin-y">
                                <div class="cell medium-3">
                                    <p
                                        style="
                                            margin-top: 0px;
                                            margin-bottom: 2px;
                                        "
                                    >
                                        {{ pickupBranch?.branchName }}
                                    </p>
                                    <p
                                        style="
                                            margin-top: 0px;
                                            margin-bottom: 2px;
                                        "
                                    >
                                        {{ pickupBranch?.address?.address1 }}
                                    </p>
                                    <p
                                        style="
                                            margin-top: 0px;
                                            margin-bottom: 2px;
                                        "
                                    >
                                        {{ pickupBranch?.address?.address2 }}
                                    </p>
                                    <p
                                        style="
                                            margin-top: 0px;
                                            margin-bottom: 2px;
                                        "
                                    >
                                        {{ pickupBranch?.address?.city }},
                                        {{ pickupBranch?.address?.state }}
                                        {{ pickupBranch?.address?.postalCode }}
                                    </p>
                                    <p
                                        style="
                                            margin-top: 0px;
                                            margin-bottom: 2px;
                                        "
                                    >
                                        {{ pickupBranch?.branchPhone }}
                                    </p>
                                </div>
                                <div class="cell medium-3">
                                    <a
                                        *ngIf="!changeLocation"
                                        (click)="toggleChangeLocation()"
                                        >Change Location</a
                                    >
                                    <a
                                        *ngIf="changeLocation"
                                        (click)="toggleChangeLocation()"
                                        >Hide Location</a
                                    >
                                </div>
                            </div>
                        </div>
                        <!-- Form Change Location-->
                        <div
                            *ngIf="changeLocation"
                            class="container-fluid"
                            style="
                                background: #e8e8e8;
                                padding: 15px;
                                margin-top: 15px;
                            "
                        >
                            <div>
                                <!-- <form style="margin-bottom: 0px"> -->
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        justify-content: flex-start;
                                    "
                                >
                                    <input
                                        mat-input
                                        type="search"
                                        [(ngModel)]="mapInfo.zipSearch"
                                        width="190"
                                    />
                                    <span>&nbsp; Search area &nbsp;</span>
                                    <mat-select
                                        style="width: 200px"
                                        [(ngModel)]="mapInfo.range"
                                    >
                                        <mat-option
                                            *ngFor="let opt of distanceOptions"
                                            [value]="opt.value"
                                            >{{ opt.text }}</mat-option
                                        >
                                    </mat-select>
                                </div>
                                <br />
                                <div style="text-align: left">
                                    <button mat-raised-button>Reset</button>
                                    <span>&nbsp;</span>
                                    <button
                                        mat-button
                                        color="primary"
                                        (click)="mapInfo.setZipCode()"
                                    >
                                        Submit
                                    </button>
                                </div>
                                <!-- </form> -->
                            </div>
                            <!-- Map -->
                            <div class="grid-x">
                                <div class="cell large-9">
                                    <div class="map-section">
                                        <agm-map
                                            class="map"
                                            [mapDraggable]="true"
                                            [draggableCursor]="'default'"
                                            [disableDefaultUI]="true"
                                            [latitude]="mapInfo.latitude"
                                            [longitude]="mapInfo.longitude"
                                            [zoom]="mapInfo.zoom"
                                            [maxZoom]="mapInfo.maxZoom"
                                            [fitBounds]="mapInfo.fitBounds"
                                            (centerChange)="
                                                mapInfo.mapCenterChange($event)
                                            "
                                            (boundsChange)="
                                                mapInfo.boundsChange($event)
                                            "
                                            (zoomChange)="
                                                mapInfo.zoomChange($event)
                                            "
                                        >
                                            <agm-marker
                                                *ngFor="
                                                    let loc of mapInfo.locations$
                                                        | async
                                                "
                                                [latitude]="loc.latitude"
                                                [longitude]="loc.longitude"
                                                [iconUrl]="
                                                    '/assets/images/finder-icon.png'
                                                "
                                                [label]="{
                                                    text: loc.label,
                                                    color: '#fff',
                                                    fontWeight: '700',
                                                    fontFamily: 'Catamaran',
                                                    fontSize: '16px'
                                                }"
                                                [title]="' '"
                                                [agmFitBounds]="true"
                                                [markerClickable]="true"
                                            >
                                                <agm-info-window>
                                                    <div>
                                                        <b>{{
                                                            loc.branchName
                                                        }}</b>
                                                    </div>
                                                    <div>
                                                        <i
                                                            >Distance
                                                            {{
                                                                loc.distance
                                                            }}</i
                                                        >
                                                    </div>
                                                    <div>
                                                        {{
                                                            loc.address.address1
                                                        }}
                                                    </div>
                                                    <div>
                                                        {{
                                                            loc.address.address2
                                                        }}
                                                    </div>
                                                    <div>
                                                        {{ loc.address.city }},
                                                        {{ loc.address.state }}
                                                    </div>
                                                    <div>
                                                        {{
                                                            loc.address
                                                                .postalCode
                                                        }}
                                                    </div>
                                                    <div>
                                                        {{
                                                            formatPhone(
                                                                loc.branchPhone
                                                            )
                                                        }}
                                                    </div>
                                                    <div>
                                                        <a
                                                            href="https://www.google.com/maps/dir/?api=1&destination={{
                                                                encodeUri(
                                                                    loc.address
                                                                        .address1
                                                                )
                                                            }} {{
                                                                encodeUri(
                                                                    loc.address
                                                                        .city
                                                                )
                                                            }} {{
                                                                encodeUri(
                                                                    loc.address
                                                                        .state
                                                                )
                                                            }} {{
                                                                encodeUri(
                                                                    loc.address
                                                                        .postalCode
                                                                )
                                                            }}"
                                                            target="_blank"
                                                            >Get Directions</a
                                                        >
                                                    </div>
                                                    <div
                                                        *ngIf="
                                                            !isBranchSelected(
                                                                loc
                                                            )
                                                        "
                                                    >
                                                        <a
                                                            (click)="
                                                                changePickupLocation(
                                                                    loc
                                                                )
                                                            "
                                                            >Change Location to
                                                            Here</a
                                                        >
                                                    </div>
                                                </agm-info-window>
                                            </agm-marker>
                                        </agm-map>
                                    </div>
                                </div>
                                <div class="cell large-3 location-options">
                                    <div
                                        class="location-option"
                                        *ngFor="
                                            let loc of mapInfo.locations$
                                                | async
                                        "
                                    >
                                        <div>
                                            <div>
                                                <b
                                                    >{{ loc.label }} -
                                                    {{ loc.branchName }}</b
                                                >
                                            </div>
                                            <div>
                                                <i
                                                    >Distance
                                                    {{ loc.distance }}</i
                                                >
                                            </div>
                                            <div>
                                                {{ loc.address.address1 }}
                                            </div>
                                            <div>
                                                {{ loc.address.address2 }}
                                            </div>
                                            <div>
                                                {{ loc.address.city }},
                                                {{ loc.address.state }}
                                            </div>
                                            <div>
                                                {{ loc.address.postalCode }}
                                            </div>
                                            <div>{{ loc.branchPhone }}</div>
                                            <div></div>
                                            <div *ngIf="!isBranchSelected(loc)">
                                                <a
                                                    (click)="
                                                        changePickupLocation(
                                                            loc
                                                        )
                                                    "
                                                    >Change Location to Here</a
                                                >
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- shipping address form -->
                <div *ngIf="DeliveryMethod">
                    <div>
                        <p style="font-weight: bold">
                            ENTER THE "SHIP TO" ADDRESS
                        </p>
                    </div>
                    <mat-divider class="divider"></mat-divider>
                    <form>
                        <div>
                            <!-- address book selector, if chosen it fills the form, if not blanks it to enter custom -->
                            <mat-form-field
                                class="full-width"
                                floatLabel="auto"
                            >
                                <mat-select
                                    placeholder="Address Book"
                                    [(value)]="addressBook"
                                >
                                    <mat-option (click)="emptyForm()"
                                        >Use custom one</mat-option
                                    >
                                    <mat-option
                                        *ngFor="
                                            let address of addressBooks?.addressBooks
                                        "
                                        [value]="address"
                                    >
                                        {{ address.addressBookInfo.nickName ||
                                            '' +
                                            address.addressBookInfo.firstName +
                                                ' ' +
                                            address.addressBookInfo.lastName
                                         }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="class grid-x">
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        placeholder="Nickname"
                                        matInput
                                        value=""
                                        [(ngModel)]="
                                            addressBook.addressBookInfo.nickName
                                        "
                                        name="nickname"
                                    />
                                </mat-form-field>
                            </div>
                            <div class="cell medium-2 large-2"></div>
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        placeholder="First Name"
                                        matInput
                                        [(ngModel)]="
                                            addressBook.addressBookInfo
                                                .firstName
                                        "
                                        name="first"
                                    />
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="class grid-x">
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        matInput
                                        placeholder="Last Name"
                                        [formControl]="lastNameFormControl"
                                        [errorStateMatcher]="matcher"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo.lastName
                                        "
                                        name="last"
                                        required
                                    />
                                    <mat-error
                                        *ngIf="
                                            lastNameFormControl.hasError(
                                                'required'
                                            )
                                        "
                                    >
                                        This field is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div class="cell medium-2 large-2"></div>
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        matInput
                                        placeholder="Address 1"
                                        [formControl]="addressFormControl"
                                        [errorStateMatcher]="matcher"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo.address1
                                        "
                                        name="address1"
                                        required
                                    />
                                    <mat-error
                                        *ngIf="
                                            addressFormControl.hasError(
                                                'required'
                                            )
                                        "
                                    >
                                        This field is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="class grid-x">
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        matInput
                                        placeholder="Address 2"
                                        value=""
                                        [(ngModel)]="
                                            addressBook.addressBookInfo.address2
                                        "
                                        name="address2"
                                    />
                                </mat-form-field>
                            </div>
                            <div class="cell medium-2 large-2"></div>
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        matInput
                                        placeholder="City"
                                        [formControl]="cityFormControl"
                                        [errorStateMatcher]="matcher"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo.city
                                        "
                                        name="city"
                                        required
                                    />
                                    <mat-error
                                        *ngIf="
                                            cityFormControl.hasError('required')
                                        "
                                    >
                                        This field is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="class grid-x">
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <mat-select
                                        placeholder="State"
                                        [formControl]="stateFormControl"
                                        [errorStateMatcher]="matcher"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo.state
                                        "
                                        required
                                        name="state"
                                    >
                                        <mat-option
                                            *ngFor="let state of states"
                                            [value]="state.value"
                                        >
                                            {{ state.key }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error
                                        *ngIf="
                                            stateFormControl.hasError(
                                                'required'
                                            )
                                        "
                                    >
                                        This field is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div class="cell medium-2 large-2"></div>
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        matInput
                                        placeholder="Zip/Postal Code"
                                        [formControl]="zipFormControl"
                                        [errorStateMatcher]="matcher"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo
                                                .postalCode
                                        "
                                        name="zip"
                                        required
                                    />
                                    <mat-error
                                        *ngIf="
                                            zipFormControl.hasError('required')
                                        "
                                    >
                                        This field is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="class grid-x">
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <mat-select
                                        placeholder="Country"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo
                                                .countryValue
                                        "
                                        name="country"
                                    >
                                        <mat-option [value]="'USA'">
                                            United States
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="cell medium-2 large-2"></div>
                            <div class="cell medium-5 large-5">
                                <mat-form-field
                                    class="full-width"
                                    floatLabel="auto"
                                >
                                    <input
                                        matInput
                                        placeholder="Phone Number"
                                        (keyup)="addDash()"
                                        name="phone"
                                        [formControl]="phoneFormControl"
                                        [errorStateMatcher]="matcher"
                                        maxlength="12"
                                        placeholder="Phone Number"
                                        [(ngModel)]="
                                            addressBook.addressBookInfo
                                                .phoneNumber
                                        "
                                        required
                                    />
                                    <mat-error
                                        *ngIf="
                                            phoneFormControl.hasError(
                                                'required'
                                            )
                                        "
                                    >
                                        This field is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </form>
                    <div>
                        <mat-checkbox color="primary" [(ngModel)]="saveAddress"
                            >Save to Address Book</mat-checkbox
                        >
                    </div>
                </div>
                <div>
                    <p>
                        <span style="font-weight: bold">ORDER NOTES</span>&nbsp;
                        <span class="font-small"
                            >(Hold Number, Special Instructions, Missing Items,
                            etc.)</span
                        >
                    </p>
                </div>
                <div>
                    <mat-form-field class="full-width" floatLabel="auto">
                        <textarea
                            maxlength="234"
                            matInput
                            [(ngModel)]="orderNotes"
                            [formControl]="orderNotesFormControl"
                            [errorStateMatcher]="matcher"
                        >
                        </textarea>
                        <mat-error
                            *ngIf="orderNotesFormControl.hasError('maxLength')"
                        >
                            Maximum of 234 characters are allowed for this field
                        </mat-error>
                    </mat-form-field>
                    <div *ngIf="orderNotes.length > 0" class="font-small">
                        {{ 234 - orderNotes.length }} more characters allowed
                    </div>
                </div>
                <!-- buttons to go between views -->
                <div class="flexContainerButton">
                    <p>
                        <button
                            color="secondary"
                            mat-raised-button
                            matStepperPrevious
                            type="button"
                        >
                            Back
                        </button>
                    </p>
                    <div
                        *ngIf="
                            ((requiredForms && dateAndDate) ||
                                (!DeliveryMethod && !DeliveryOpt) ||
                                (!DeliveryMethod && dateAndDate) ||
                                (!DeliveryOpt && requiredForms)) &&
                                orderNotes.length <= 234;
                            else Button
                        "
                    >
                        <p>
                            <button
                                color="emphasis"
                                mat-raised-button
                                (click)="submitShippingInfo()"
                                matStepperNext
                            >
                                Next
                            </button>
                        </p>
                    </div>
                    <ng-template #Button>
                        <p>
                            <button color="disabled" mat-raised-button disabled>
                                Next
                            </button>
                        </p>
                    </ng-template>
                </div>
            </mat-step>
            <mat-step mat>
                <ng-template matStepLabel disabled>
                    <span>Order Review</span>
                    <!-- <mat-icon>done</mat-icon> -->
                </ng-template>
                <app-quote-disclaimer></app-quote-disclaimer>
                <mat-divider class="divider"></mat-divider>
                <div
                    *ngIf="quoteOrderDetail.po.length > 22"
                    style="margin-bottom: 30px"
                    class="callout alert ng-star-inserted"
                >
                    Please edit your PO# to be equal or less than 22 characters.
                    Currently
                    {{ quoteOrderDetail.po.length }}
                    characters.
                </div>
                <div *ngIf="DeliveryOpt">
                    <div>
                        <p style="font-weight: bold">
                            PREFERED PICKUP/DELIVERY DATE AND TIME
                        </p>
                    </div>
                    <!-- date with a pipe to format it -->
                    <div class="flexContainerButton">
                        <p>
                            <span style="font-weight: bold; margin-right: 10px"
                                >Date:</span
                            >
                            {{ date }}
                        </p>
                        <p class="time">
                            <span style="font-weight: bold; margin-right: 10px"
                                >Time:</span
                            >
                            {{
                                quoteOrderDetail.deliveryTime
                                    ? quoteOrderDetail.deliveryTime
                                    : time
                            }}
                        </p>
                    </div>
                    <mat-divider class="divider"></mat-divider>
                </div>
                <div class="grid-x">
                    <div class="medium-5 large-5">
                        <div>
                            <p style="font-weight: bold">Delivery Option:</p>
                        </div>
                        <div *ngIf="!DeliveryOpt">
                            <p>Place Order On Hold</p>
                        </div>
                        <div *ngIf="DeliveryOpt">
                            <p>Schedule Delivery or Pick Up</p>
                        </div>
                    </div>
                    <div class="medium-5 large-5">
                        <mat-form-field class="formInput" floatLabel="auto">
                            <mat-label>PO#</mat-label>
                            <input
                                matInput
                                value=""
                                [(ngModel)]="quoteOrderDetail.po"
                                name="PO"
                            />
                        </mat-form-field>
                    </div>
                </div>
                <div class="grid-x">
                    <div class="medium-5 large-5">
                        <div>
                            <p style="font-weight: bold">Delivery Method:</p>
                        </div>
                        <div *ngIf="DeliveryMethod">
                            <p>Ship to Address</p>
                        </div>
                        <div *ngIf="!DeliveryMethod">
                            <p>Pick Up</p>
                        </div>
                    </div>

                    <div *ngIf="jobs?.jobs?.length" class="medium-5 large-5">
                        <mat-form-field class="formInput" floatLabel="auto">
                            <mat-label>Job Account</mat-label>
                            <mat-select
                                [(ngModel)]="job"
                                [formControl]="jobFormControl"
                                [errorStateMatcher]="matcher"
                                name="job"
                            >
                                <mat-option
                                    *ngFor="let job of jobs?.jobs"
                                    [value]="job"
                                >
                                    {{ job.jobName }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div *ngIf="!jobs?.jobs?.length" class="medium-5 large-5">
                        <mat-form-field class="formInput" floatLabel="auto">
                            <mat-label>Jobs</mat-label>
                            <input
                                matInput
                                placeholder="Job Name"
                                maxlength="15"
                                [(ngModel)]="job.jobName"
                            />
                        </mat-form-field>
                    </div>
                </div>
                <div class="grid-x">
                    <div class="medium-5 large-5">
                        <div *ngIf="DeliveryMethod">
                            <p style="font-weight: bold">Shipping Address:</p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ addressBook.addressBookInfo.nickName }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ addressBook.addressBookInfo.firstName }}
                                {{ addressBook.addressBookInfo.lastName }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ addressBook.addressBookInfo.address1 }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ addressBook.addressBookInfo.city }}
                                {{ addressBook.addressBookInfo.stateValue }}
                                {{ addressBook.addressBookInfo.postalCode }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ addressBook.addressBookInfo.country }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                Phone Number:
                                {{ addressBook.addressBookInfo.phoneNumber }}
                            </p>
                        </div>
                        <div *ngIf="!DeliveryMethod">
                            <p style="font-weight: bold">
                                Store Pick-up Address
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ pickupBranch?.branchName }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ pickupBranch?.address?.address1 }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ pickupBranch?.address?.address2 }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ pickupBranch?.address?.city }},
                                {{ pickupBranch?.address?.state }}
                                {{ pickupBranch?.address?.postalCode }}
                            </p>
                            <p style="margin-top: 0px; margin-bottom: 2px">
                                {{ pickupBranch?.branchPhone }}
                            </p>
                        </div>
                    </div>
                    <div class="medium-5 large-5">
                        <p style="font-weight: bold">
                            Add email confirmation recipients
                            <a color="primary" (click)="add()">Add input</a>
                        </p>
                        <div
                            *ngFor="let word2 of words2; let in = index"
                            class="col-sm-3"
                        >
                            <div class="form-group">
                                <mat-form-field
                                    class="form-email"
                                    floatLabel="auto"
                                >
                                    <mat-label>E-mail</mat-label>
                                    <input
                                        matInput
                                        [(ngModel)]="words2[in].value"
                                        name="name{{ in }}"
                                    />
                                </mat-form-field>
                                <!-- <p style="text-align: right"> -->
                                <a color="warning" (click)="deleteInput(in)">
                                    <mat-icon>delete</mat-icon>
                                </a>
                                <!-- </p> -->
                            </div>
                        </div>
                        <div>
                            <p style="font-weight: bold">Order Notes:</p>
                            {{ orderNotes }}
                        </div>
                    </div>
                </div>
                <div>
                    <!-- table of items for checkout -->
                    <table
                        mat-table
                        [dataSource]="cartItems"
                        matSort
                        class="full-width padded-table"
                    >
                        <ng-container matColumnDef="product">
                            <th mat-header-cell *matHeaderCellDef>Product</th>
                            <td mat-cell *matCellDef="let element">
                                <img
                                    appImagePreload
                                    style="height: 80px; width: 80px"
                                    src="{{ element.thumbImageUrl }}"
                                    default="{{
                                        element.imageOnErrorUrl | errorImage
                                    }}"
                                />
                            </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <ng-container matColumnDef="details">
                            <th mat-header-cell *matHeaderCellDef>Details</th>
                            <td mat-cell *matCellDef="let element">
                                <div
                                    [innerHTML]="
                                        element.description
                                            ? element.description
                                            : element.atgItemDescription
                                    "
                                ></div>
                                <div>
                                    <strong>Item #:</strong>
                                    <span>{{ element.itemNumber }}</span>
                                </div>
                            </td>
                            <td mat-footer-cell *matFooterCellDef>
                                <strong>Sub-Total</strong>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="price">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                            >
                                Price
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <div
                                    *ngIf="
                                        element.price > 0 ||
                                            element.atgItemNetPrice > 0;
                                        else noPrice
                                    "
                                >
                                    <strong>
                                        <span>{{
                                            element.price ||
                                                element.atgItemNetPrice
                                                | currency
                                        }}</span>
                                        <span> / </span>
                                        <span>{{ element.uom }}</span>
                                    </strong>
                                </div>
                                <ng-template #noPrice>
                                    <span>Price calculated at invoicing</span>
                                </ng-template>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="qty">
                            <th mat-header-cell *matHeaderCellDef>Qty</th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.quantity }}
                            </td>
                            <td mat-footer-cell *matFooterCellDef>&nbsp;</td>
                        </ng-container>
                        <ng-container matColumnDef="total">
                            <th mat-header-cell *matHeaderCellDef>Total</th>
                            <td mat-cell *matCellDef="let element">
                                <div
                                    *ngIf="
                                        !element.quotedItemQtyChanged;
                                        else noSubTotalOrderReview
                                    "
                                >
                                    <span>
                                        {{
                                            element.price * element.quantity
                                                | totalPrice
                                                | currency
                                        }}</span
                                    >
                                </div>
                                <ng-template #noSubTotalOrderReview>
                                    <span>Price calculated at invoicing</span>
                                </ng-template>
                            </td>
                        </ng-container>
                        <tr
                            mat-header-row
                            *matHeaderRowDef="displayedColumns2"
                        ></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: displayedColumns2"
                        ></tr>
                    </table>
                </div>
                <div class="flexContainerButton">
                    <p>
                        <button
                            color="secondary"
                            mat-raised-button
                            matStepperPrevious
                            type="button"
                        >
                            Back
                        </button>
                    </p>
                    <div *ngIf="this.userPermValueApprove">
                        <!-- removing && !this.warningAlert in ngIf -->
                        <div *ngIf="canPlaceOrder; else Disable">
                            <p>
                                <button
                                    color="emphasis"
                                    mat-raised-button
                                    (click)="placeOrder()"
                                >
                                    Place Order
                                    <mat-icon>arrow_right_alt </mat-icon>
                                </button>
                            </p>
                        </div>
                        <ng-template #Disable>
                            <p>
                                <button
                                    color="disabled"
                                    mat-raised-button
                                    disabled
                                >
                                    Place Order
                                    <mat-icon>arrow_right_alt</mat-icon>
                                </button>
                            </p>
                        </ng-template>
                    </div>
                    <!-- Submit for approver button - start -->
                    <p *ngIf="!this.userPermValueApprove">
                        <!-- removing && !this.warningAlert in color  &  [disables] || this.warningAlert-->
                        <button
                            color="{{ canPlaceOrder ? 'primary' : 'disable' }}"
                            [disabled]="!canPlaceOrder"
                            mat-raised-button
                            class="cell"
                            [matMenuTriggerFor]="menu"
                        >
                            <span>Submit for Approval</span>
                            <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu" direction="down">
                            <button
                                mat-menu-item
                                (click)="openDialogueApprove(approver)"
                                *ngFor="let approver of approvers"
                            >
                                {{ approver.email }}
                            </button>
                        </mat-menu>
                    </p>
                    <!-- Submit for approver button - end -->
                </div>

                <div
                    *ngIf="
                        !cartQtyChanged &&
                            cartSummary &&
                            cartSummary.total &&
                            cartSummary.total != 0;
                        else TotalZero
                    "
                >
                    <div class="grid-x">
                        <div class="small-6">
                            <h3>Order Summary</h3>
                            <div class="grid-x">
                                <div class="small-12">
                                    <mat-divider></mat-divider>
                                </div>
                                <div class="small-6">
                                    <span style="font-weight: bold">
                                        Items:</span
                                    >
                                </div>
                                <div class="small-6">
                                    {{ itemTotal }}
                                </div>
                                <div class="small-12">
                                    <mat-divider></mat-divider>
                                </div>
                                <div class="small-6">
                                    <span style="font-weight: bold">
                                        Other Charges: </span
                                    ><button
                                        class="icon"
                                        matTooltipPosition="left"
                                        matTooltip="What is Other Charges?
                  Other charges are typically delivery fees, but may include handling and fuel fees."
                                        matTooltipClass="custom-tooltip"
                                    >
                                        <mat-icon>info</mat-icon>
                                    </button>
                                </div>
                                <div class="small-6">
                                    {{ otherCharges }}
                                </div>
                                <div class="small-12">
                                    <mat-divider></mat-divider>
                                </div>
                                <div class="small-6">
                                    <span style="font-weight: bold"
                                        >Estimated Tax:</span
                                    >
                                </div>
                                <div class="small-6">
                                    {{ getTax }}
                                </div>
                                <div class="small-12">
                                    <mat-divider></mat-divider>
                                </div>
                                <div class="small-6">
                                    <span style="font-weight: bold"
                                        >Estimated Total:</span
                                    >
                                </div>
                                <div class="small-6">
                                    {{ getTotal }}
                                </div>
                                <div class="small-12">
                                    <mat-divider></mat-divider>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--  -->

                <ng-template #TotalZero>
                    <div class="total">
                        <div>
                            <h3>ORDER TOTAL</h3>
                        </div>
                        <div>
                            <p>
                                Pricing will be calculated at the time of
                                invoicing.
                            </p>
                        </div>
                    </div>
                </ng-template>
            </mat-step>
        </mat-horizontal-stepper>
    </div>
    <ng-template #emptyCart>
        <div>
            <p class="cartEmpty">Your order is currently empty.</p>
        </div>
        <div>
            <p style="text-align: center">
                <app-product-selector
                    [accountId]="accountId"
                    (productAdded)="addProduct($event)"
                >
                </app-product-selector>
                <span>&nbsp;</span>
            </p>
        </div>
    </ng-template>
</ng-template>
<!-- <app-dump-grid [input]="values" max-depth="4"></app-dump-grid> -->
